version: 3
tables:
  - table:
      schema: public
      name: chats
    object_relationships:
      - name: user
        using:
          manual_configuration:
            remote_table:
              schema: auth
              name: users
            column_mapping:
              user_id: id
    array_relationships:
      - name: messages
        using:
          foreign_key_constraint_on:
            column: chat_id
            table:
              schema: public
              name: messages
    select_permissions:
      - role: user
        permission:
          columns: [id, user_id, title, created_at]
          filter:
            user_id: { _eq: X-Hasura-User-Id }
    insert_permissions:
      - role: user
        permission:
          check:
            user_id: { _eq: X-Hasura-User-Id }
          columns: [user_id, title]
          set:
            user_id: x-hasura-User-Id
    update_permissions:
      - role: user
        permission:
          columns: [title]
          filter:
            user_id: { _eq: X-Hasura-User-Id }
    delete_permissions:
      - role: user
        permission:
          filter:
            user_id: { _eq: X-Hasura-User-Id }

  - table:
      schema: public
      name: messages
    object_relationships:
      - name: chat
        using:
          foreign_key_constraint_on: chat_id
    select_permissions:
      - role: user
        permission:
          columns: [id, chat_id, role, content, created_at]
          filter:
            chat:
              user_id: { _eq: X-Hasura-User-Id }
    insert_permissions:
      - role: user
        permission:
          check:
            chat:
              user_id: { _eq: X-Hasura-User-Id }
          columns: [chat_id, role, content]
    update_permissions:
      - role: user
        permission:
          columns: [content]
          filter:
            chat:
              user_id: { _eq: X-Hasura-User-Id }
    delete_permissions:
      - role: user
        permission:
          filter:
            chat:
              user_id: { _eq: X-Hasura-User-Id }

